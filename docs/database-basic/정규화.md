# 정규화

## 기본개념

**데이터베이스 정규화**는 **중복을 최소화**하고 **데이터 무결성**을 유지하기 위해 데이터를 구조화하는 설계 과정이다. 정규화를 통해 데이터베이스 성능을 향상시키고, 유지보수를 용이하게 할 수 있다.

정규화는 **데이터 간의 관계**를 명확히 하고, **중복된 데이터를 제거**하여 데이터의 **일관성**과 **정확성**을 높인다. 
- 갱신, 삽입, 삭제 시 발생할 수 있는 문제를 방지할 수 있다.
- DB 의 저장 용량을 줄일 수 있다. 
- 데이터를 중복 저장하지 않도록 설계함으로써, 한 곳의 데이터만 수정하면 동일한 데이터를 여러 곳에서 수정할 필요가 없게 된다.

정규화는 제1정규형(1NF)부터 시작하여 제3정규형(3NF) 또는 그 이상의 단계까지 진행한다.


## 이상현상 (Anomalies)

데이터베이스에서 비정규화된 테이블 때문에 발생하는 문제들이다.

삽입 이상(Insertion Anomaly)
- 삽입 이상은 데이터를 삽입할 때, 불필요하거나 관련 없는 데이터를 함께 입력해야 하는 상황을 말한다.

갱신 이상(Update Anomaly)
- 갱신 이상은 동일한 데이터가 여러 테이블에 중복되어 저장되어 있을 때, 일부만 수정할 경우 데이터 불일치가 발생하는 현상이다.

삭제 이상(Deletion Anomaly)
- 삭제 이상은 특정 데이터를 삭제할 때, 원치 않는 데이터도 함께 삭제되는 현상이다.

## 제 1 정규형 (1NF)

제1 정규형이란 테이블의 각 열(Column)이 원자값(Atomic Value), 즉 하나의 값만 가지도록 데이터를 정리하는 과정이다. 

다음과 같은 **학생과 취미** 데이터를 포함한 테이블이 있다고 가정한다.

| 학생 이름 | 취미         |
|-----------|--------------|
| 김민수    | 독서, 음악   |
| 이영희    | 운동         |
| 박철수    | 음악, 그림   |
| 정다은    | 영화         |

여기서, **김민수**와 **박철수**는 여러 개의 취미를 가지고 있다.  

이를 **제1 정규형**에 맞게 변환하려면, **각 취미를 별도의 행으로 분리**해야 한다.

| 학생 이름 | 취미    |
|-----------|---------|
| 김민수    | 독서    |
| 김민수    | 음악    |
| 이영희    | 운동    |
| 박철수    | 음악    |
| 박철수    | 그림    |
| 정다은    | 영화    |

이제 각 열에는 **하나의 값만 존재하므로 제1 정규형을 만족**하게 된다.

## 제 2 정규형 (2NF)

제2 정규형(2NF)은 제1 정규형(1NF)을 만족하면서, 부분적 함수 종속을 제거하는 단계다. 
- 기본 키의 일부만으로 결정될 수 있는 속성을 분리하여 독립적인 테이블로 만드는 과정이다.

> 제2 정규형은 기본적으로 복합키가 있을 때만 관련된 문제이다. 즉, 기본 키가 하나의 열로만 구성되어 있을 경우에는 부분적 함수 종속이 발생할 수 없으므로 자동으로 제2 정규형을 만족하게 된다.

다음과 같은 학생 성적 테이블이 있다면, PK 는 (학생번호, 강좌이름) 으로 복합키다.

성적은 PK 에 의해서 결정된다. 
- PK -> 성적

- 교수이름은 과목에만 종속되어 있다. 
- 강좌이름 -> 교수이름

PK (학생번호, 강좌이름) 의 부분집합인 강좌이름에 의해 교수이름이 결정되므로 부분적 함수 종속이 발생한다.
따라서**제2 정규형**을 만족하지 않는 상태다.

| 학생번호 | 과목      | 교수이름 | 성적 |
|----------|-----------|----------|------|
| 501      | 데이터베이스 | 김교수  | 3.5  |
| 502      | 데이터베이스 | 김교수  | 4.0  |
| 501      | 자료구조   | 박교수  | 3.8  |
| 502      | 자료구조   | 박교수  | 3.9  |

이를 **제2 정규형**으로 변환하려면, **교수이름**을 별도의 테이블로 분리해야 한다.  

- 성적 테이블

   | 학생번호 | 과목        | 성적 |
   |----------|-------------|------|
   | 501      | 데이터베이스 | 3.5  |
   | 502      | 데이터베이스 | 4.0  |
   | 501      | 자료구조     | 3.8  |
   | 502      | 자료구조     | 3.9  |

- 교과목 테이블

   | 과목        | 교수이름 |
   |-------------|----------|
   | 데이터베이스 | 김교수   |
   | 자료구조     | 박교수   |

**교수이름**이 **과목** 테이블에 별도로 관리되므로, **부분적 종속성**이 제거되어 **제2 정규형을 만족**한다.

## 제 3 정규형 (3NF)

제3 정규형(3NF)은 제2 정규형을 만족하면서, 이행적 종속을 제거하는 단계다.

> 이행적 종속
> - A -> B, B -> C  이면 A -> C 

다음과 같은 도서 관리 테이블에서 
- 책 ID -> 책 제목, 저자
- 저자 -> 저자 국적

즉, 책 ID -> 저자 -> 저자 국적의 이행적 종속이 발생하고 있다. 

이 경우, 같은 저자의 국적이 반복해서 나타나므로 데이터의 중복이 발생한다.

| 책 ID  | 책 제목        | 저자   | 저자 국적   |
|--------|----------------|--------|-------------|
| 001    | 데이터베이스   | 홍길동 | 한국        |
| 002    | 인공지능 개론  | 이영희 | 한국        |
| 003    | 데이터 분석    | 김철수 | 미국        |
| 004    | 알고리즘 설계  | 이영희 | 한국        |


이행적 종속을 제거하려면, **저자 국적**을 별도의 테이블로 분리해야 한다.  

- 도서 테이블

   | 책 ID  | 책 제목        | 저자   |
   |--------|----------------|--------|
   | 001    | 데이터베이스   | 홍길동 |
   | 002    | 인공지능 개론  | 이영희 |
   | 003    | 데이터 분석    | 김철수 |
   | 004    | 알고리즘 설계  | 이영희 |

- 저자 테이블

   | 저자   | 저자 국적 |
   |--------|-----------|
   | 홍길동 | 한국      |
   | 이영희 | 한국      |
   | 김철수 | 미국      |

저자 국적은 저자에 따라 결정되며, 도서 테이블에서는 저자 국적에 대한 중복 정보가 사라지게 된다. 또한, 저자의 국적이 변경되면 저자 테이블에서만 수정하면 되므로 데이터의 일관성이 유지된다.

## BCNF (Boyce and Codd Normal Form)

BCNF 는 제3 정규형을 강화시킨 형태로, **모든 결정자가 후보키가 되도록** 테이블을 분리하는 것이다. 
- 이행적 종속뿐만 아니라 **결정자에 의한 종속성**을 제거한다.

다음과 같은 **수업 배정** 테이블에서 PK 는 (학생번호, 과목이름)이다. 

한 과목당 교수 1명이 가르치고 이름이 동일한 교수는 없다고 가정한다. 이때 과목 이름이 교수 이름에 의해 결정되므로, 교수 이름이 결정자 역할을 한다. (반대로 교수이름도, 과목이름에 따라 결정된다.)

하지만 **교수이름은**은 후보키가 아니므로 BCNF 를 위반한다.

| 학생번호 | 과목이름      | 교수이름 |
|----------|---------------|----------|
| 101      | 물리학        | 김교수   |
| 102      | 물리학        | 김교수   |
| 103      | 화학          | 이교수   |
| 101      | 생물학        | 박교수   |
| 102      | 생물학        | 박교수   |


이를 BCNF 정규형에 맞추기 위해 별도의 테이블로 분리한다. 

- 수업신청 테이블

   | 학생번호 | 과목이름  |
   |----------|------------|
   | 101      | 물리학     |
   | 102      | 물리학     |
   | 103      | 화학       |
   | 101      | 생물학     |
   | 102      | 생물학     |

- 과목교수 테이블
   | 과목이름  | 교수이름 |
   |-----------|----------|
   | 물리학    | 김교수   |
   | 화학      | 이교수   |
   | 생물학    | 박교수   |

이렇게 분리해두고 과목이름을 PK 로 둔다면 교수이름은 후보키이므로 BCNF 를 만족시킨다.

> **이행적 함수 종속성 위반과 결정자 위반**  
> 이행적 종속성은 기본 키가 아닌 속성이 또 다른 기본 키가 아닌 속성에 종속되는 경우로, 이는 제3 정규형에서 처리된다.  
> 결정자 위반은 결정자(어떤 값을 결정하는 속성)가 후보 키가 아닐 때 발생하는 문제로 제3 정규형에서도 해결되지 않으며, BCNF로 변환해야 해결할 수 있는 문제다.

## 정규화의 단점

복잡한 쿼리와 성능 저하
- 정규화된 테이블은 여러 개로 분리되기 때문에 데이터를 조회할 때 JOIN 연산이 많이 필요하다. 이는 쿼리의 복잡성을 증가시키고, 성능이 저하될 수 있다. 

쓰기 성능 저하
- 데이터 수정 작업 증가: 정규화된 구조에서는 데이터를 수정할 때 여러 테이블을 수정해야 하므로, INSERT, UPDATE, DELETE 작업이 비효율적일 수 있다. 

구조 복잡성 증가
- 테이블이 많아지면 데이터베이스의 구조가 복잡해지며, 이를 유지하고 관리하는 작업이 어려워질 수 있다. 개발자와 관리자 모두에게 추가적인 부담이 발생한다.