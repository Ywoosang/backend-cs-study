# 커넥션(Connection) 과 세션(Session)

## 커넥션(Connection)이란?

커넥션은 클라이언트(애플리케이션)와 데이터베이스 서버 간의 물리적 연결 또는 네트워크 연결을 의미한다.
- 애플리케이션이 데이터베이스와 통신하기 위해 네트워크 소켓이나 TCP/IP 연결을 통해 데이터베이스 서버에 연결하는 과정 

커넥션은 하드웨어적인 연결 개념이며, 클라이언트가 데이터베이스 서버에 요청을 보내고 응답을 받기 위해 필요하다.

### 세션(Session)이란?

세션은 커넥션이 맺어진 이후, 클라이언트와 데이터베이스 간의 상태를 관리하는 단위다. 
세션은 애플리케이션이 데이터베이스와 상호작용하는 동안 유지되는 작업의 컨텍스트를 의미하며, 세션이 열리는 동안 사용자의 트랜잭션 상태, 변수, 잠금 등이 세션 단위로 관리된다.

### 3. 커넥션과 세션의 관계
커넥션과 세션은 하나의 커넥션에서 하나의 세션이 생성되는 관계를 갖는다. 구체적으로는 다음과 같다:

- 커넥션은 세션을 생성하는 기반이다. 클라이언트가 데이터베이스에 연결하면, 그 연결을 통해 하나의 세션이 시작된다.
- 세션은 커넥션이 열려 있는 동안에만 유지된다. 커넥션이 끊어지면 세션도 동시에 종료된다.
- 하나의 커넥션이 열릴 때마다 데이터베이스는 해당 커넥션에 대한 하나의 세션을 할당하여, 클라이언트의 상태를 추적하고, 트랜잭션이나 잠금과 같은 데이터를 세션 단위로 관리한다.

즉, 세션은 커넥션을 통해 데이터베이스와 상호작용하는 상태 정보를 유지하는 논리적 공간이며, 커넥션이 없다면 세션도 생성되지 않는다.

### 4. 커넥션 풀(Connection Pool)과 세션의 관계
애플리케이션에서는 커넥션 풀(Connection Pool)을 사용하여 데이터베이스와의 연결을 효율적으로 관리한다. 커넥션 풀은 애플리케이션이 필요로 하는 데이터베이스 연결을 미리 만들어두고, 클라이언트가 필요할 때 재사용할 수 있도록 하는 기술이다.

- 커넥션 풀은 다수의 커넥션을 유지하여 성능을 최적화한다. 각 커넥션이 사용되면 풀에서 제공되고, 사용이 끝나면 다시 풀로 반환된다.
- 세션은 커넥션에 종속되어 있기 때문에, 커넥션 풀에서 커넥션을 제공받을 때마다 세션도 함께 시작된다.
- 커넥션이 풀에서 반납되면 그 세션도 종료되고, 새로운 세션이 필요하면 풀에서 새로운 커넥션이 제공되어 새로운 세션이 시작된다.

#### 스프링 부트 예시:
- 스프링 부트(Spring Boot)와 같은 프레임워크에서 커넥션 풀을 사용해 데이터베이스와의 연결을 관리할 수 있으며, 이를 통해 애플리케이션은 여러 요청을 효율적으로 처리할 수 있다.
- 각 클라이언트 요청은 커넥션 풀에서 커넥션을 할당받고, 이 커넥션을 통해 데이터베이스 세션을 생성하여 트랜잭션을 처리하게 된다.

### 5. 세션과 커넥션이 혼동될 수 있는 이유
커넥션과 세션이 종종 혼동되는 이유는 이 둘이 동시에 발생하며, 서로 밀접하게 관련되어 있기 때문이다.

- 커넥션은 물리적인 연결을 의미하지만, 그 위에서 세션이 논리적으로 관리된다.
- 클라이언트가 데이터베이스와 연결할 때, 이 커넥션이 바로 세션의 생성 및 유지 기반이 되기 때문에, 많은 상황에서 세션과 커넥션이 함께 언급된다.
- 세션은 데이터베이스 상에서의 상태와 작업을 관리하고, 커넥션은 그 상태와 작업을 실행하는 물리적 통로 역할을 한다.

### 6. 커넥션이 끊어질 때 세션에 미치는 영향
커넥션이 끊어지면 그와 연결된 세션도 즉시 종료된다. 이로 인해 세션 내에서 유지되고 있던 트랜잭션, 잠금, 임시 테이블, 세션 변수 등이 모두 해제되고 사라진다. 또한, 세션이 종료되면 트랜잭션이 커밋되지 않았을 경우 자동 롤백되어 데이터 무결성이 보장된다.

### 7. 트랜잭션 외에도 세션이 중요한 이유
세션은 단순히 트랜잭션을 실행하는 것 외에도 다양한 데이터를 유지하고 관리한다. 다음과 같은 작업에서 세션이 중요한 역할을 한다:

- 임시 테이블 관리: 세션 내에서 생성된 임시 테이블은 그 세션 동안에만 유효하다.
- 세션 변수: 각 세션은 고유한 변수를 관리할 수 있으며, 다른 세션에서는 해당 변수에 접근할 수 없다.
- 사용자 인증 및 권한 관리: 세션은 데이터베이스 사용자의 권한을 추적하고, 해당 세션에서 어떤 작업을 허용할지 결정하는 데 사용된다.
- 잠금 관리: 트랜잭션이 자원을 잠그면, 해당 잠금은 세션 단위로 관리되며, 세션이 종료되면 잠금도 해제된다.

### 8. 커넥션과 세션의 예시
예를 들어, 웹 애플리케이션에서 사용자가 로그인하여 데이터베이스에 질의를 보낸다고 가정해보자:
- 사용자가 애플리케이션에 로그인하면, 애플리케이션은 데이터베이스와의 커넥션을 통해 서버에 연결한다.
- 이 커넥션이 맺어지면, 데이터베이스는 해당 커넥션을 기반으로 세션을 생성하여 사용자의 상태, 트랜잭션, 변수 등을 관리하기 시작한다.
- 사용자가 SQL 쿼리를 실행하면, 세션 내에서 트랜잭션이 발생하고 해당 쿼리의 결과가 세션을 통해 반환된다.
- 사용자가 로그아웃하거나 커넥션이 종료되면, 해당 세션도 종료되고 트랜잭션이 완료되거나 롤백된다.

### 요약
- 커넥션: 클라이언트와 데이터베이스 간의 물리적 연결.
- 세션: 커넥션을 통해 생성되는 논리적 작업 단위로, 클라이언트의 상태, 트랜잭션, 잠금 등을 관리.
- 관계: 커넥션이 있어야 세션이 생성되며, 커넥션이 끊어지면 세션도 종료된다.
- 세션은 트랜잭션 관리 외에도 변수, 잠금, 임시 테이블, 사용자 권한 등을 관리하는 중요한 역할을 한다.