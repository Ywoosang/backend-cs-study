# 트랜잭션 격리수준

## 격리 수준(Isolation Level)이란?

격리수준은한 트랜잭션이 다른 트랜잭션이 변경한 데이터에 접근할 수 있는 정도를 결정하는 요소다. 격리 수준이 높아질수록 트랜잭션 간 고립 정도가 증가 하며, 데이터 무결성은 더 잘 보장되지만 성능 저하가 발생할 수 있다.

일반적으로 성능과 일관성의 균형을 맞추기 위해 READ COMMITTED나 REPEATABLE READ 격리 수준을 많이 사용한다.

### 격리 수준의 필요성

격리 수준은 트랜잭션의 ACID 특성 중 하나인 고립성(Isolation)을 보장하기 위해 사용된다. 트랜잭션이 동시에 수행될 때 데이터의 일관성과 무결성을 보장하려면 Locking 메커니즘이 필요하지만, 무조건적인 Locking은 성능 저하를 초래할 수 있다. 반대로 너무 느슨한 Locking은 데이터의 무결성 문제를 일으킬 수 있다. 
따라서 적절한 격리 수준을 선택하는 것이 중요하다.

격리 수준은 각 DBMS에 따라 기본값이 다르기 때문에 사용하는 DBMS의 특성을 이해하고 적절한 격리 수준을 설정하는 것이 중요하다.
- MySQL 8.0에서 기본 격리 수준은 Repeatable Read 다.
- InnoDB 스토리지 엔진은 MVCC 를 사용해 트랜잭션이 시작된 후에도 일관된 데이터를 읽을 수 있도록 하고, 동시에 커밋되지 않은 데이터를 읽지 않게 한다.

### 트랜잭션 간 상호작용 문제

1. Dirty Read:
    - 커밋되지 않은 다른 트랜잭션의 데이터를 읽는 상황을 의미한다. 예를 들어, 한 트랜잭션이 아직 완료되지 않았는데 그 데이터를 다른 트랜잭션이 읽어가면, 나중에 트랜잭션이 롤백될 경우 읽은 데이터가 잘못된 정보가 될 수 있다.

2. Non-repeatable Read:
    - 같은 트랜잭션 내에서 같은 쿼리를 여러 번 실행했을 때 결과가 다르게 나오는 상황이다. 한 트랜잭션이 데이터를 읽고 있는 사이 다른 트랜잭션이 그 데이터를 수정하면, 같은 쿼리로 조회하더라도 다른 결과가 나올 수 있다. 이는 데이터 수정이나 삭제가 발생할 때 주로 발생한다.

3. Phantom Read:
    - 트랜잭션 내에서 같은 쿼리를 여러 번 실행했을 때, 처음에는 없던 데이터가 나중에 나타나는 상황이다. 주로 다른 트랜잭션이 데이터를 삽입한 경우 발생하며, 이를 방지하기 위해서는 가장 높은 격리 수준인 SERIALIZABLE을 사용해야 한다.

### 격리 수준의 종류

각 격리 수준은 트랜잭션 간 상호작용 문제를 방지하는 정도가 다르다. 이에 따라 성능과 일관성 사이의 trade-off 가 존재한다.

1. Read Uncommitted (Level 0):
    - 트랜잭션이 커밋되지 않은 데이터를 읽을 수 있는 가장 낮은 격리 수준이다. Dirty Read가 발생할 수 있으며, 데이터 무결성에 심각한 문제가 생길 수 있다.
   - RDBMS 표준에서는 거의 사용되지 않는다.
    - 특징: 트랜잭션 중에도 다른 트랜잭션이 데이터를 읽거나 수정할 수 있으며, Select문에 Shared Lock이 걸리지 않는다.

2. Read Committed (Level 1):
    - 트랜잭션이 커밋된 데이터만 읽을 수 있는 기본적인 격리 수준이다. 대부분의 RDBMS에서 기본 설정으로 사용되며, Dirty Read 문제는 방지할 수 있지만 Non-repeatable Read가 발생할 수 있다.
    - 특징: Select문을 실행할 때 Shared Lock이 걸리며, 데이터를 조회할 때 실제 테이블 값이 아니라 Undo 영역의 백업된 레코드를 사용할 수 있다.

3. Repeatable Read (Level 2):
    - 트랜잭션이 시작 전에 커밋된 데이터만 읽을 수 있는 격리 수준이다. MySQL에서 기본으로 사용되며, Non-repeatable Read를 방지할 수 있다.
    - 트랜잭션이 완료될 때까지 조회한 데이터에 대한 공유 락이 유지되므로, 트랜잭션이 실행 중인 동안 다른 트랜잭션이 데이터를 수정할 수 없다.
    - 하지만, Phantom Read가 여전히 발생할 수 있다.

4. Serializable (Level 3):
    - 가장 높은 격리 수준으로, 트랜잭션들이 순차적으로 실행되는 것처럼 보이게 한다. 트랜잭션 간의 동시성이 거의 차단되며, Phantom Read 문제도 방지된다.
    - 성능 저하가 크기 때문에 일반적인 환경에서는 거의 사용되지 않지만, 데이터 무결성이 가장 중요할 때 적용할 수 있다.
